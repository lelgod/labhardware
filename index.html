<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cruzamento com Sem√°foros - Assembly</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        header {
            text-align: center;
            padding: 20px 0;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #bdc3c7;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        .simulation-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .intersection {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            position: relative;
            min-height: 400px;
        }

        .road {
            position: absolute;
            background: #555;
        }

        .road-horizontal {
            width: 100%;
            height: 80px;
            top: 50%;
            transform: translateY(-50%);
            left: 0;
        }

        .road-vertical {
            width: 80px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
            top: 0;
        }

        .center-square {
            position: absolute;
            width: 100px;
            height: 100px;
            background: #444;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 10px;
        }

        .traffic-light {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .traffic-light.horizontal {
            width: 80px;
            height: 200px;
        }

        .traffic-light.vertical {
            width: 200px;
            height: 80px;
            flex-direction: row;
        }

        .traffic-light.west {
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .traffic-light.east {
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .traffic-light.north {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .traffic-light.south {
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .light {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #111;
            transition: all 0.3s ease;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
            margin: 5px;
        }

        .light.active.red {
            background: #ff4444;
            box-shadow: 0 0 20px #ff4444;
        }

        .light.active.yellow {
            background: #ffcc00;
            box-shadow: 0 0 20px #ffcc00;
        }

        .light.active.green {
            background: #44ff44;
            box-shadow: 0 0 20px #44ff44;
        }

        .traffic-info {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .semaphore-status {
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
        }

        .semaphore-status h3 {
            margin-bottom: 10px;
            color: #3498db;
        }

        .code-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .code-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .code-display {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.5;
            height: 500px;
            overflow-y: auto;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .code-line {
            padding: 4px 8px;
            margin: 1px 0;
            border-radius: 4px;
            transition: all 0.3s ease;
            white-space: pre;
        }

        .code-line.active {
            background: rgba(41, 128, 185, 0.3);
            border-left: 4px solid #3498db;
        }

        .code-line.comment {
            color: #6a9955;
        }

        .code-line.label {
            color: #dcdcaa;
        }

        .code-line.instruction {
            color: #9cdcfe;
        }

        .code-line.register {
            color: #569cd6;
        }

        .code-line.number {
            color: #b5cea8;
        }

        .editable-time {
            background: transparent;
            border: 1px dashed #b5cea8;
            color: #b5cea8;
            width: 35px;
            text-align: center;
            margin: 0 3px;
            padding: 1px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .editable-time:focus {
            outline: none;
            border: 1px solid #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .mode-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mode-btn.active {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        button {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #play-btn {
            background: #2ecc71;
            color: white;
        }

        #pause-btn {
            background: #f39c12;
            color: white;
        }

        #reset-btn {
            background: #e74c3c;
            color: white;
        }

        #step-btn {
            background: #3498db;
            color: white;
        }

        .current-phase {
            text-align: center;
            margin-top: 20px;
            font-size: 1.3rem;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            font-weight: bold;
        }

        .phase-1 { color: #44ff44; }
        .phase-2 { color: #ffcc00; }
        .phase-3 { color: #ff4444; }

        .explanation {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        .explanation h2 {
            margin-bottom: 15px;
            color: #3498db;
        }

        .explanation p {
            line-height: 1.6;
            margin-bottom: 10px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cruzamento Controlado por Assembly</h1>
            <p class="subtitle">Controlador central gerenciando m√∫ltiplos sem√°foros</p>
        </header>

        <div class="main-content">
            <div class="simulation-container">
                <div class="intersection">
                    <div class="road road-horizontal"></div>
                    <div class="road road-vertical"></div>
                    <div class="center-square"></div>
                    
                    <!-- Sem√°foros nas 4 dire√ß√µes -->
                    <div class="traffic-light horizontal west">
                        <div class="light red" id="west-red"></div>
                        <div class="light yellow" id="west-yellow"></div>
                        <div class="light green" id="west-green"></div>
                    </div>
                    
                    <div class="traffic-light horizontal east">
                        <div class="light red" id="east-red"></div>
                        <div class="light yellow" id="east-yellow"></div>
                        <div class="light green" id="east-green"></div>
                    </div>
                    
                    <div class="traffic-light vertical north">
                        <div class="light red" id="north-red"></div>
                        <div class="light yellow" id="north-yellow"></div>
                        <div class="light green" id="north-green"></div>
                    </div>
                    
                    <div class="traffic-light vertical south">
                        <div class="light red" id="south-red"></div>
                        <div class="light yellow" id="south-yellow"></div>
                        <div class="light green" id="south-green"></div>
                    </div>
                </div>

                <div class="current-phase" id="current-phase">
                    Fase 1: Via Leste-Oeste Verde
                </div>

                <div class="traffic-info">
                    <div class="semaphore-status">
                        <h3>Via Leste-Oeste</h3>
                        <div id="status-horizontal">Estado: Verde</div>
                        <div>Tempo: <span id="time-horizontal">0</span>s</div>
                    </div>
                    <div class="semaphore-status">
                        <h3>Via Norte-Sul</h3>
                        <div id="status-vertical">Estado: Vermelho</div>
                        <div>Tempo: <span id="time-vertical">0</span>s</div>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-header">
                    <div class="code-title">Controlador Central - Assembly</div>
                    <div class="code-info">Linha: <span id="current-line">1</span></div>
                </div>
                <div class="code-display" id="code-display">
                    <!-- C√≥digo ser√° inserido via JavaScript -->
                </div>
                <div class="controls">
                    <div class="mode-selector">
                        <div class="mode-btn active" id="mode-step">Modo Passo a Passo</div>
                        <div class="mode-btn" id="mode-auto">Modo Autom√°tico</div>
                    </div>
                    <div class="action-buttons">
                        <button id="play-btn">
                            ‚ñ∂ Executar
                        </button>
                        <button id="pause-btn" disabled>
                            ‚è∏ Pausar
                        </button>
                        <button id="step-btn">
                            ‚è≠ Passo
                        </button>
                        <button id="reset-btn">
                            üîÑ Reiniciar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h2>Como Funciona o Controlador Central</h2>
            <p>Este simulador mostra um <strong>controlador central √∫nico</strong> que gerencia todos os sem√°foros do cruzamento atrav√©s de c√≥digo Assembly.</p>
            <p><strong>Fase 1:</strong> Via Leste-Oeste (Horizontal) fica verde enquanto Norte-Sul fica vermelho</p>
            <p><strong>Fase 2:</strong> Transi√ß√£o com amarelos</p>
            <p><strong>Fase 3:</strong> Via Norte-Sul (Vertical) fica verde enquanto Leste-Oeste fica vermelho</p>
            <p>O controlador envia sinais simult√¢neos para todos os sem√°foros, garantindo a sincroniza√ß√£o perfeita do cruzamento.</p>
        </div>
    </div>

    <script>
        // C√≥digo Assembly para controlador central do cruzamento
        const assemblyCode = [
            { text: "; CRUZAMENTO.ASM - Controlador Central", type: "comment" },
            { text: "; Controla 4 sem√°foros em cruzamento", type: "comment" },
            { text: "", type: "empty" },
            { text: "START:", type: "label" },
            { text: "    MOV R0, #0        ; Contador geral", type: "instruction" },
            { text: "", type: "empty" },
            { text: "; === FASE 1: LESTE-OESTE VERDE === ", type: "comment" },
            { text: "FASE1:", type: "label" },
            { text: "    MOV R1, #", type: "instruction", timeValue: true, timeType: "green", defaultValue: 10 },
            { text: "        ; Tempo fase verde", type: "comment" },
            { text: "    ; Leste-Oeste: VERDE", type: "comment" },
            { text: "    MOV [0x1000], #2  ; Oeste: Verde", type: "instruction" },
            { text: "    MOV [0x1001], #2  ; Leste: Verde", type: "instruction" },
            { text: "    ; Norte-Sul: VERMELHO", type: "comment" },
            { text: "    MOV [0x1002], #1  ; Norte: Vermelho", type: "instruction" },
            { text: "    MOV [0x1003], #1  ; Sul: Vermelho", type: "instruction" },
            { text: "FASE1_LOOP:", type: "label" },
            { text: "    CMP R0, R1", type: "instruction" },
            { text: "    BGE FASE2        ; Se tempo esgotou, vai para fase 2", type: "instruction" },
            { text: "    ADD R0, R0, #1   ; Incrementa contador", type: "instruction" },
            { text: "    JMP FASE1_LOOP", type: "instruction" },
            { text: "", type: "empty" },
            { text: "; === FASE 2: TRANSI√á√ÉO AMARELO === ", type: "comment" },
            { text: "FASE2:", type: "label" },
            { text: "    MOV R0, #0       ; Reseta contador", type: "instruction" },
            { text: "    MOV R1, #", type: "instruction", timeValue: true, timeType: "yellow", defaultValue: 3 },
            { text: "        ; Tempo amarelo", type: "comment" },
            { text: "    ; Leste-Oeste: AMARELO", type: "comment" },
            { text: "    MOV [0x1000], #3  ; Oeste: Amarelo", type: "instruction" },
            { text: "    MOV [0x1001], #3  ; Leste: Amarelo", type: "instruction" },
            { text: "    ; Norte-Sul: VERMELHO (mant√©m)", type: "comment" },
            { text: "    MOV [0x1002], #1  ; Norte: Vermelho", type: "instruction" },
            { text: "    MOV [0x1003], #1  ; Sul: Vermelho", type: "instruction" },
            { text: "FASE2_LOOP:", type: "label" },
            { text: "    CMP R0, R1", type: "instruction" },
            { text: "    BGE FASE3        ; Vai para fase 3", type: "instruction" },
            { text: "    ADD R0, R0, #1", type: "instruction" },
            { text: "    JMP FASE2_LOOP", type: "instruction" },
            { text: "", type: "empty" },
            { text: "; === FASE 3: NORTE-SUL VERDE === ", type: "comment" },
            { text: "FASE3:", type: "label" },
            { text: "    MOV R0, #0       ; Reseta contador", type: "instruction" },
            { text: "    MOV R1, #", type: "instruction", timeValue: true, timeType: "green", defaultValue: 10 },
            { text: "        ; Tempo fase verde", type: "comment" },
            { text: "    ; Leste-Oeste: VERMELHO", type: "comment" },
            { text: "    MOV [0x1000], #1  ; Oeste: Vermelho", type: "instruction" },
            { text: "    MOV [0x1001], #1  ; Leste: Vermelho", type: "instruction" },
            { text: "    ; Norte-Sul: VERDE", type: "comment" },
            { text: "    MOV [0x1002], #2  ; Norte: Verde", type: "instruction" },
            { text: "    MOV [0x1003], #2  ; Sul: Verde", type: "instruction" },
            { text: "FASE3_LOOP:", type: "label" },
            { text: "    CMP R0, R1", type: "instruction" },
            { text: "    BGE FASE4        ; Vai para fase 4", type: "instruction" },
            { text: "    ADD R0, R0, #1", type: "instruction" },
            { text: "    JMP FASE3_LOOP", type: "instruction" },
            { text: "", type: "empty" },
            { text: "; === FASE 4: TRANSI√á√ÉO AMARELO === ", type: "comment" },
            { text: "FASE4:", type: "label" },
            { text: "    MOV R0, #0       ; Reseta contador", type: "instruction" },
            { text: "    MOV R1, #", type: "instruction", timeValue: true, timeType: "yellow", defaultValue: 3 },
            { text: "        ; Tempo amarelo", type: "comment" },
            { text: "    ; Leste-Oeste: VERMELHO (mant√©m)", type: "comment" },
            { text: "    MOV [0x1000], #1  ; Oeste: Vermelho", type: "instruction" },
            { text: "    MOV [0x1001], #1  ; Leste: Vermelho", type: "instruction" },
            { text: "    ; Norte-Sul: AMARELO", type: "comment" },
            { text: "    MOV [0x1002], #3  ; Norte: Amarelo", type: "instruction" },
            { text: "    MOV [0x1003], #3  ; Sul: Amarelo", type: "instruction" },
            { text: "FASE4_LOOP:", type: "label" },
            { text: "    CMP R0, R1", type: "instruction" },
            { text: "    BGE START        ; Volta para fase 1", type: "instruction" },
            { text: "    ADD R0, R0, #1", type: "instruction" },
            { text: "    JMP FASE4_LOOP", type: "instruction" },
            { text: "", type: "empty" },
            { text: "END START", type: "instruction" }
        ];

        // Elementos DOM
        const codeDisplay = document.getElementById('code-display');
        const currentLineSpan = document.getElementById('current-line');
        const currentPhaseDiv = document.getElementById('current-phase');
        
        // Sem√°foros
        const lights = {
            west: { red: document.getElementById('west-red'), yellow: document.getElementById('west-yellow'), green: document.getElementById('west-green') },
            east: { red: document.getElementById('east-red'), yellow: document.getElementById('east-yellow'), green: document.getElementById('east-green') },
            north: { red: document.getElementById('north-red'), yellow: document.getElementById('north-yellow'), green: document.getElementById('north-green') },
            south: { red: document.getElementById('south-red'), yellow: document.getElementById('south-yellow'), green: document.getElementById('south-green') }
        };

        // Status
        const statusHorizontal = document.getElementById('status-horizontal');
        const statusVertical = document.getElementById('status-vertical');
        const timeHorizontal = document.getElementById('time-horizontal');
        const timeVertical = document.getElementById('time-vertical');
        
        // Bot√µes
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const stepBtn = document.getElementById('step-btn');
        const resetBtn = document.getElementById('reset-btn');
        const modeStepBtn = document.getElementById('mode-step');
        const modeAutoBtn = document.getElementById('mode-auto');

        // Estado da simula√ß√£o
        let currentLine = 0;
        let isPlaying = false;
        let playInterval;
        let executionMode = "step";
        let currentPhase = 1;
        let timeValues = { green: 10, yellow: 3 };
        let currentCounters = { horizontal: 0, vertical: 0 };

        // Inicializar c√≥digo
        function initializeCode() {
            codeDisplay.innerHTML = '';
            assemblyCode.forEach((line, index) => {
                const lineElement = document.createElement('div');
                lineElement.className = `code-line ${line.type}`;
                lineElement.dataset.line = index;
                
                if (line.timeValue) {
                    const textBefore = document.createTextNode(line.text);
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'editable-time';
                    input.value = timeValues[line.timeType];
                    input.dataset.timeType = line.timeType;
                    
                    input.addEventListener('change', function() {
                        const newValue = parseInt(this.value);
                        if (!isNaN(newValue) && newValue > 0) {
                            timeValues[this.dataset.timeType] = newValue;
                        } else {
                            this.value = timeValues[this.dataset.timeType];
                        }
                    });
                    
                    const textAfter = document.createTextNode(line.type === 'instruction' ? 
                        '        ; Tempo ' + line.timeType : '');
                    
                    lineElement.appendChild(textBefore);
                    lineElement.appendChild(input);
                    lineElement.appendChild(textAfter);
                } else {
                    lineElement.textContent = line.text;
                }
                
                codeDisplay.appendChild(lineElement);
            });
            highlightCurrentLine();
        }

        // Destacar linha atual
        function highlightCurrentLine() {
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('active');
            });
            
            if (currentLine < assemblyCode.length) {
                const currentLineElement = document.querySelector(`.code-line[data-line="${currentLine}"]`);
                if (currentLineElement) {
                    currentLineElement.classList.add('active');
                    currentLineElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            currentLineSpan.textContent = currentLine + 1;
        }

        // Atualizar sem√°foros
        function updateTrafficLights(west, east, north, south) {
            // Reset all lights
            Object.values(lights).forEach(semaphore => {
                Object.values(semaphore).forEach(light => light.classList.remove('active'));
            });

            // Update based on state (1=red, 2=green, 3=yellow)
            if (west === 2) lights.west.green.classList.add('active');
            else if (west === 3) lights.west.yellow.classList.add('active');
            else lights.west.red.classList.add('active');

            if (east === 2) lights.east.green.classList.add('active');
            else if (east === 3) lights.east.yellow.classList.add('active');
            else lights.east.red.classList.add('active');

            if (north === 2) lights.north.green.classList.add('active');
            else if (north === 3) lights.north.yellow.classList.add('active');
            else lights.north.red.classList.add('active');

            if (south === 2) lights.south.green.classList.add('active');
            else if (south === 3) lights.south.yellow.classList.add('active');
            else lights.south.red.classList.add('active');

            updateStatus();
        }

        // Atualizar status
        function updateStatus() {
            const westState = lights.west.green.classList.contains('active') ? 'Verde' : 
                             lights.west.yellow.classList.contains('active') ? 'Amarelo' : 'Vermelho';
            const northState = lights.north.green.classList.contains('active') ? 'Verde' : 
                              lights.north.yellow.classList.contains('active') ? 'Amarelo' : 'Vermelho';

            statusHorizontal.textContent = `Estado: ${westState}`;
            statusVertical.textContent = `Estado: ${northState}`;
            
            timeHorizontal.textContent = currentCounters.horizontal;
            timeVertical.textContent = currentCounters.vertical;
        }

        // Executar passo
        function executeStep() {
            if (currentLine >= assemblyCode.length) {
                currentLine = 0;
            }
            
            const line = assemblyCode[currentLine];
            
            // Simular mudan√ßas de fase
            if (line.text.includes("FASE1:")) {
                currentPhase = 1;
                currentCounters = { horizontal: 0, vertical: 0 };
                currentPhaseDiv.textContent = "Fase 1: Via Leste-Oeste Verde";
                currentPhaseDiv.className = "current-phase phase-1";
                updateTrafficLights(2, 2, 1, 1); // Leste-Oeste verde, Norte-Sul vermelho
            } else if (line.text.includes("FASE2:")) {
                currentPhase = 2;
                currentCounters = { horizontal: 0, vertical: 0 };
                currentPhaseDiv.textContent = "Fase 2: Transi√ß√£o Amarelo";
                currentPhaseDiv.className = "current-phase phase-2";
                updateTrafficLights(3, 3, 1, 1); // Leste-Oeste amarelo, Norte-Sul vermelho
            } else if (line.text.includes("FASE3:")) {
                currentPhase = 3;
                currentCounters = { horizontal: 0, vertical: 0 };
                currentPhaseDiv.textContent = "Fase 3: Via Norte-Sul Verde";
                currentPhaseDiv.className = "current-phase phase-3";
                updateTrafficLights(1, 1, 2, 2); // Leste-Oeste vermelho, Norte-Sul verde
            } else if (line.text.includes("FASE4:")) {
                currentPhase = 4;
                currentCounters = { horizontal: 0, vertical: 0 };
                currentPhaseDiv.textContent = "Fase 4: Transi√ß√£o Amarelo";
                currentPhaseDiv.className = "current-phase phase-2";
                updateTrafficLights(1, 1, 3, 3); // Leste-Oeste vermelho, Norte-Sul amarelo
            }
            
            // Simular incremento de contador
            if (line.text.includes("ADD R0, R0, #1")) {
                if (currentPhase === 1 || currentPhase === 2) {
                    currentCounters.horizontal++;
                } else {
                    currentCounters.vertical++;
                }
                updateStatus();
            }
            
            currentLine++;
            highlightCurrentLine();
            
            if (currentLine >= assemblyCode.length) {
                currentLine = 0;
            }
        }

        // Executar ciclo autom√°tico
        function executeAutoCycle() {
            if (currentPhase === 1) {
                currentCounters.horizontal++;
                if (currentCounters.horizontal >= timeValues.green) {
                    currentPhase = 2;
                    currentCounters.horizontal = 0;
                    currentPhaseDiv.textContent = "Fase 2: Transi√ß√£o Amarelo";
                    currentPhaseDiv.className = "current-phase phase-2";
                    updateTrafficLights(3, 3, 1, 1);
                }
            } else if (currentPhase === 2) {
                currentCounters.horizontal++;
                if (currentCounters.horizontal >= timeValues.yellow) {
                    currentPhase = 3;
                    currentCounters.horizontal = 0;
                    currentCounters.vertical = 0;
                    currentPhaseDiv.textContent = "Fase 3: Via Norte-Sul Verde";
                    currentPhaseDiv.className = "current-phase phase-3";
                    updateTrafficLights(1, 1, 2, 2);
                }
            } else if (currentPhase === 3) {
                currentCounters.vertical++;
                if (currentCounters.vertical >= timeValues.green) {
                    currentPhase = 4;
                    currentCounters.vertical = 0;
                    currentPhaseDiv.textContent = "Fase 4: Transi√ß√£o Amarelo";
                    currentPhaseDiv.className = "current-phase phase-2";
                    updateTrafficLights(1, 1, 3, 3);
                }
            } else if (currentPhase === 4) {
                currentCounters.vertical++;
                if (currentCounters.vertical >= timeValues.yellow) {
                    currentPhase = 1;
                    currentCounters.vertical = 0;
                    currentCounters.horizontal = 0;
                    currentPhaseDiv.textContent = "Fase 1: Via Leste-Oeste Verde";
                    currentPhaseDiv.className = "current-phase phase-1";
                    updateTrafficLights(2, 2, 1, 1);
                }
            }
            
            updateStatus();
        }

        // Controles
        function startExecution() {
            if (isPlaying) return;
            
            isPlaying = true;
            playBtn.disabled = true;
            pauseBtn.disabled = false;
            
            if (executionMode === "step") {
                playInterval = setInterval(executeStep, 800);
            } else {
                playInterval = setInterval(executeAutoCycle, 1000);
            }
        }

        function pauseExecution() {
            if (!isPlaying) return;
            
            isPlaying = false;
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            clearInterval(playInterval);
        }

        function resetSimulation() {
            pauseExecution();
            currentLine = 0;
            currentPhase = 1;
            currentCounters = { horizontal: 0, vertical: 0 };
            currentPhaseDiv.textContent = "Fase 1: Via Leste-Oeste Verde";
            currentPhaseDiv.className = "current-phase phase-1";
            updateTrafficLights(2, 2, 1, 1);
            if (executionMode === "step") highlightCurrentLine();
            updateStatus();
        }

        function setExecutionMode(mode) {
            executionMode = mode;
            modeStepBtn.classList.toggle('active', mode === 'step');
            modeAutoBtn.classList.toggle('active', mode === 'auto');
            
            if (mode === 'step') {
                codeDisplay.style.display = 'block';
                currentLineSpan.style.display = 'inline';
                stepBtn.disabled = false;
                highlightCurrentLine();
            } else {
                codeDisplay.style.display = 'none';
                currentLineSpan.style.display = 'none';
                stepBtn.disabled = true;
            }
            
            if (isPlaying) {
                pauseExecution();
                resetSimulation();
            }
        }

        // Event listeners
        playBtn.addEventListener('click', startExecution);
        pauseBtn.addEventListener('click', pauseExecution);
        stepBtn.addEventListener('click', executeStep);
        resetBtn.addEventListener('click', resetSimulation);
        modeStepBtn.addEventListener('click', () => setExecutionMode('step'));
        modeAutoBtn.addEventListener('click', () => setExecutionMode('auto'));

        // Inicializar
        initializeCode();
        updateTrafficLights(2, 2, 1, 1); // Estado inicial
        updateStatus();
    </script>
</body>
</html>
